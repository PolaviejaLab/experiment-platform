#!/usr/bin/env node

var fs = require('fs');
var https = require('https');

var port = process.env.PORT || 3000;
var useSSL = true;
var privateKey = fs.readFileSync('privatekey.pem');
var certificate = fs.readFileSync('certificate.pem');

var app = require('../app');

process.on("uncaughtException", function(err) {
    if(err.errno == 'EADDRINUSE') {
        console.log("ExpressJS could not start because a server is already running on port " + app.get('port'));
        process.exit(1);
    } else {
        console.log('>>', err);
        throw(err);
    }
});

var options;
if(useSSL) {
    options = { key: privateKey, cert: certificate };
} else {
    options = {};
}

https.createServer(options, app).listen(port, function() {
    console.log('Express server listening on port ' + port);
});
